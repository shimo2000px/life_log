<link rel="stylesheet" href="/likes_counter.css">
<% content_for(:title, '日記詳細') %>
<div class="container pt-5">
  <div class="row mb-3">
    <div class="col-lg-8 offset-lg-2">
      <span class="badge bg-success me-2 fs-6 px-3 py-2"><%= @post.diary_date.strftime("%m/%d") %></span>

      <h1 class="mt-3"><%= @post.title %></h1>
      <div class="mb-3">
        <small class="text-muted">
          投稿者: <%= current_user.nick_name %> 
                    <% if current_user.profile_image.present? %>
            <%= image_tag current_user.profile_image, 
                class: "rounded-circle", 
                style: "width: 50px; height: 50px; object-fit: cover;" %>
          <% else %>
            <div class="rounded-circle bg-light d-flex align-items-center justify-content-center" 
                style="width: 150px; height: 150px; margin: 0 auto;">
              <i class="fas fa-user fa-3x text-muted"></i>
            </div>
          <% end %>| 
          <%= @post.created_at.strftime("%Y年%m月%d日 %H:%M") %>
        </small>
      </div>
      
      <div class="card">
        <div class="card-body mb-4">
          <%= simple_format(@post.body) %>
        </div>
      </div>
      
      
      <!-- 擬似いいね機能 -->
      <div class="likes-counter-instagram mt-4" data-target="<%= @post.auto_likes_count %>">
        <div class="likes-block"> 
        <span class="heart-icon" data-original="♡" data-liked="♥">♡</span>
        <span class="count">0</span>
        <div class="hearts-container"></div>
      </div>

        <script src="/likes_counter.js"></script>

      
      <!-- 詳細 -->  
      <div class="mt-4 d-flex justify-content-between align-items-center">
        <div>
          <%= link_to posts_path, class: "btn btn-outline-secondary" do %>
            <i class="bi bi-arrow-left"></i> 日記一覧に戻る
          <% end %>
        </div>

        <% if @post.user == current_user %>
          <div class="btn-group">      
            <% tweet_text = "この日記をシェアします！" %>
            <% tweet_url = "https://twitter.com/intent/tweet?url=#{CGI.escape(shared_post_url(@post.share_token, host: 'd4bc3ac321f7.ngrok-free.app'))}&text=#{CGI.escape(tweet_text)}" %>
              <%= link_to share_to_twitter_post_path(@post),
                        class: "btn btn-outline-success ms-2",
                        target: "_blank",
                        rel: "noopener noreferrer",
                        title: "Xで共有" do %>
                  <i class="bi bi-twitter"></i> Xで共有
              <% end %>
              <%= link_to edit_post_path(@post), class: "btn btn-outline-primary" do %>
                <i class="bi bi-pencil"></i> 編集
              <% end %>
              <%= link_to post_path(@post), 
                          class: "btn btn-outline-danger",
                          data: { 
                            turbo_method: :delete, 
                            turbo_confirm: "投稿「#{@post.title}」を削除します。\n\n⚠️ この操作は取り消せません。\n本当に削除してもよろしいですか？"
                          } do %>
                <i class="bi bi-trash"></i> 削除
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>