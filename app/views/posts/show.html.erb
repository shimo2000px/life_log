<%= content_for :head do %>
<style>
/* â˜… ã‚¤ãƒ³ã‚¹ã‚¿ã‚°ãƒ©ãƒ é¢¨ã„ã„ã­ãƒ–ãƒ­ãƒƒã‚¯ â˜… */
.likes-counter-instagram {
  position: relative;
  display: inline-block;
  margin: 10px 0;
}

.likes-block {
  background: linear-gradient(135deg, #e91e63, #f44336);
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3);
  font-weight: 600;
  font-size: 14px;
  transition: all 0.3s ease;
  position: relative;
  min-width: 80px;
  justify-content: center;
}

.likes-block:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(233, 30, 99, 0.4);
}

.heart-icon {
  font-size: 18px;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
}

.likes-block .count {
  font-family: 'Arial', sans-serif;
  font-weight: 700;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  min-width: 40px;
  text-align: left;
}

.hearts-container {
  position: absolute;
  width: 1px;
  height: 1px;
  left: 50%;
  top: 50%;
  pointer-events: none;
  z-index: 1000;
}

.exploding-heart {
  position: absolute;
  pointer-events: none;
  z-index: 1001;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.likes-block.animating {
  animation: heartbeat 0.6s ease-in-out;
}

@keyframes heartbeat {
  0% { transform: scale(1); }
  25% { transform: scale(1.1); }
  50% { transform: scale(1.05); }
  75% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

@media (max-width: 768px) {
  .likes-block {
    padding: 6px 12px;
    font-size: 12px;
    min-width: 70px;
  }
  
  .heart-icon {
    font-size: 16px;
  }

  .heart-icon {
  font-size: 16px;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
  transition: all 0.3s ease; /* â˜… å¤‰åŒ–ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã« */
}

.heart-icon.liked {
  color: #ff3040; /* â™¥ã®æ™‚ã®è‰² */
  transform: scale(1.1);
}
}
</style>
<% end %>

<div class="container pt-5">
  <div class="row mb-3">
    <div class="col-lg-8 offset-lg-2">
      <h1><%= @post.title %></h1>
      <div class="mb-3">
        <small class="text-muted">
          æŠ•ç¨¿è€…: <%= current_user.nick_name %> | 
          <%= @post.created_at.strftime("%Yå¹´%mæœˆ%dæ—¥ %H:%M") %>
        </small>
      </div>
      
      <div class="card">
        <div class="card-body">
          <%= simple_format(@post.body) %>
        </div>
      </div>
      
      
      <!-- æ“¬ä¼¼ã„ã„ã­æ©Ÿèƒ½ -->
      <div class="likes-counter-instagram" data-target="<%= @post.auto_likes_count %>">
        <div class="likes-block"> 
        <span class="heart-icon" data-original="â™¡" data-liked="â™¥">â™¡</span>
        <span class="count">0</span>
        <div class="hearts-container"></div>
      </div>

<%= content_for :javascript do %>
<script>
document.addEventListener('turbo:load', function() {
  document.querySelectorAll('.likes-counter-instagram:not(.animated)').forEach(function(element, index) {
    const counter = element.querySelector('.count');
    const heartsContainer = element.querySelector('.hearts-container');
    const likesBlock = element.querySelector('.likes-block');
    const heartIcon = element.querySelector('.heart-icon');
    const target = parseInt(element.dataset.target);
    
    if (!counter || !target || target <= 0) return;
    
    element.classList.add('animated');
    
    setTimeout(() => {
      // â˜… ãƒ–ãƒ­ãƒƒã‚¯ã«ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ  â˜…
      likesBlock.classList.add('animating');
      
      // æ•°å­—ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      let current = 0;
      const increment = Math.ceil(target / 50);
      
      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          counter.textContent = target.toLocaleString();
          clearInterval(timer);
          
          // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†
          setTimeout(() => {
            heartIcon.textContent = heartIcon.dataset.liked;
            heartIcon.classList.add('liked');
            likesBlock.classList.remove('animating');
          }, 200);
        } else {
          counter.textContent = current.toLocaleString();
        }
      }, 30);
      
      // â˜… ãƒãƒ¼ãƒˆçˆ†ç™ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ â˜…
      if (heartsContainer) {
        animateExplodingHearts(heartsContainer, target);
      }
    }, index * 200);
  });
});

// â˜… ã‚¤ãƒ³ã‚¹ã‚¿é¢¨ãƒãƒ¼ãƒˆçˆ†ç™ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ â˜…
function animateExplodingHearts(container, targetCount) {
  const heartCount = Math.min(Math.floor(targetCount / 50), 15); // ã‚ˆã‚Šå¤šãã®ãƒãƒ¼ãƒˆ
  
  if (heartCount <= 0) return;
  
  // ãƒãƒ¼ãƒˆç”Ÿæˆ
  for (let i = 0; i < heartCount; i++) {
    setTimeout(() => {
      createInstagramHeart(container, i, heartCount);
    }, i * 100);
  }
}

function createInstagramHeart(container, index, totalHearts) {
  const heart = document.createElement('span');
  const heartTypes = ['ğŸ’–', 'ğŸ’•', 'ğŸ’—', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'â¤ï¸', 'ğŸ¤'];
  heart.textContent = heartTypes[index % heartTypes.length];
  heart.className = 'exploding-heart';
  
  // å††å½¢é…ç½®ï¼ˆã‚ˆã‚Šç¾ã—ãåˆ†æ•£ï¼‰
  const angle = (Math.PI * 2 * index) / totalHearts + (Math.random() - 0.5) * 0.5;
  const distance = Math.random() * 100 + 80; // 80-180pxã®è·é›¢
  const endX = Math.cos(angle) * distance;
  const endY = Math.sin(angle) * distance;
  
  heart.style.position = 'absolute';
  heart.style.left = '0px';
  heart.style.top = '0px';
  heart.style.transform = 'translate(-50%, -50%) scale(0) rotate(0deg)';
  heart.style.transition = 'all 2s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
  heart.style.pointerEvents = 'none';
  heart.style.zIndex = '1001';
  heart.style.fontSize = (Math.random() * 10 + 18) + 'px'; // 18-28px
  heart.style.opacity = '1';
  
  container.appendChild(heart);
  
  // â˜… ç¾ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ â˜…
  setTimeout(() => {
    const rotation = (Math.random() - 0.5) * 720; // ãƒ©ãƒ³ãƒ€ãƒ å›è»¢
    heart.style.transform = `translate(calc(-50% + ${endX}px), calc(-50% + ${endY}px)) scale(1.2) rotate(${rotation}deg)`;
    heart.style.opacity = '0';
  }, 50);
  
  // æ¸…æƒ
  setTimeout(() => {
    if (heart.parentNode) {
      heart.remove();
    }
  }, 2050);
}
</script>
<% end %>

      
  <!-- è©³ç´° -->  
  <div class="mt-4 d-flex justify-content-between align-items-center">
    <div>
      <%= link_to posts_path, class: "btn btn-outline-secondary" do %>
        <i class="bi bi-arrow-left"></i> æ—¥è¨˜ä¸€è¦§ã«æˆ»ã‚‹
      <% end %>
    </div>
    <% if @post.user == current_user %>
      <div class="btn-group">
        <%= link_to edit_post_path(@post), class: "btn btn-outline-primary" do %>
          <i class="bi bi-pencil"></i> ç·¨é›†
        <% end %>
        <%= link_to post_path(@post), 
                    data: { turbo_method: :delete, turbo_confirm: "ã€Œ#{@post.title}ã€ã‚’æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚" },
                    class: "btn btn-outline-danger" do %>
          <i class="bi bi-trash"></i> å‰Šé™¤
        <% end %>
      </div>
    <% end %>
  </div>

    </div>
  </div>
</div>